#!/usr/bin/python3
#\file    ellipse_fit_a1.py
#\brief   certain python script
#\author  Akihiko Yamaguchi, info@akihikoy.net
#\version 0.1
#\date    Jul.09, 2020
import numpy as np
from ellipse_fit1 import EllipseFit2D
#from ellipse_fit2 import EllipseFit2D
#from ellipse_fit3 import EllipseFit2D
#from ellipse_fit4 import EllipseFit2D
#from ellipse_fit5 import EllipseFit2D
#from ellipse_fit6 import EllipseFit2D
#from ellipse_fit7 import EllipseFit2D
from weighted_ellipse_fit2 import SampleWeightedEllipseFit2D

if __name__=='__main__':
  #XY= [[422.84861231767934, 183.35433718765748], [432.42098791122203, 185.66463484510922], [448.80873543846809, 198.35756013846091], [462.41213465470298, 213.99776957705564], [465.26249879343175, 223.42344059012029], [455.69012319988906, 221.11314293266855], [439.302375672643, 208.42021763931686], [425.69897645640816, 192.78000820072214], [413.36813181074763, 182.20417128937467], [429.19778386994096, 178.49865945853901], [453.73091707592442, 189.37350645742433], [472.59635472413851, 208.45837440281599], [474.74297930036346, 224.5736064884031], [458.91332724117012, 228.27911831923876], [434.38019403518666, 217.40427132035344], [415.51475638697258, 198.31940337496178], [396.04237982107253, 168.20574039810251], [420.03259937610784, 164.96296341337927], [458.09514085276896, 184.22957242547176], [487.93348367241646, 214.71944917603588], [492.06873129003856, 238.57203737967527], [468.07851173500325, 241.8148143643985], [430.01597025834212, 222.54820535230601], [400.17762743869463, 192.05832860174189]]
  XY= [[483.57791609605795, 344.49965272380518], [466.60343635334158, 338.83882694650532], [456.56851292732165, 319.65287948322805], [459.35146786358513, 298.18067815098351], [473.32208390394203, 287.00034727619482], [490.2965636466584, 292.66117305349468], [500.33148707267833, 311.84712051677195], [497.54853213641485, 333.31932184901649], [378.72596159571577, 294.20724282596018], [415.27773620874092, 266.52403561553331], [488.83496618487482, 267.67673072063207], [556.30882381469496, 296.99009498197074], [578.17403840428415, 337.29275717403982], [541.62226379125912, 364.97596438446669], [468.06503381512516, 363.82326927936793], [400.59117618530496, 334.50990501802926], [351.28732841376109, 288.63217779178427], [402.34876578708764, 231.78625395704097], [497.98927404900689, 224.12515380661273], [582.18394057194246, 270.13664590592191], [605.61267158623889, 342.86782220821573], [554.55123421291239, 399.71374604295903], [458.91072595099308, 407.37484619338727], [374.71605942805752, 361.36335409407809], [347.09013789669746, 223.94559624794104], [432.07848968166377, 184.27923831751852], [544.23064330338764, 221.62666952517262], [617.84938821961384, 314.11027118925574], [609.80986210330252, 407.55440375205899], [524.82151031833621, 447.22076168248151], [412.66935669661234, 409.87333047482741], [339.05061178038613, 317.38972881074426], [324.47896703995247, 268.67011748046099], [395.69108564781953, 197.05229911101293], [515.38225387592058, 194.96598409982846], [613.43900867251352, 263.63330748507695], [632.42103296004757, 362.82988251953901], [561.2089143521805, 434.44770088898707], [441.51774612407945, 436.53401590017154], [343.46099132748645, 367.8666925149231], [399.79017895955246, 470.93958277112137], [327.23470482198888, 377.03236326086932], [343.25909976145329, 247.22676648667471], [438.4764905512302, 157.56115056692747], [557.10982104044751, 160.56041722887863], [629.66529517801121, 254.46763673913068], [613.64090023854669, 384.27323351332524], [518.42350944876966, 473.93884943307251], [378.31960574211183, 483.21973685897842], [313.07435158356498, 377.62379407282771], [344.70390938112109, 235.78302187429452], [454.68011314883546, 140.78582091980701], [578.58039425788809, 148.28026314102161], [643.82564841643489, 253.87620592717229], [612.19609061887888, 395.7169781257054], [502.21988685116457, 490.71417908019293], [318.63430757546553, 442.82141793822223], [289.82701239800645, 310.5017396194778], [371.51250518246297, 181.25642105277791], [515.84053210483023, 130.79561698126417], [638.26569242453445, 188.67858206177775], [667.07298760199353, 320.9982603805222], [585.387494817537, 450.24357894722209], [441.0594678951698, 500.70438301873588]]
  with open('/tmp/data.dat','w') as fp:
    for x,y in XY:
      fp.write('%f %f\n'%(x,y))

  #c,r1,r2,angle= EllipseFit2D(XY)
  c,r1,r2,angle= SampleWeightedEllipseFit2D(XY,[1.0]*len(XY))
  print('estimated:',c,r1,r2,angle)
  with open('/tmp/fit.dat','w') as fp:
    for th in np.linspace(0, 2*np.pi, 1000):
      x= c[0] + r1*np.cos(angle)*np.cos(th) - r2*np.sin(angle)*np.sin(th)
      y= c[1] + r1*np.sin(angle)*np.cos(th) + r2*np.cos(angle)*np.sin(th)
      fp.write('%f %f\n'%(x,y))

  print('#Plot by:')
  print('''qplot -x /tmp/data.dat /tmp/fit.dat w l''')

