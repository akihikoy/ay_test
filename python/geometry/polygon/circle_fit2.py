#!/usr/bin/python3
#\file    circle_fit2.py
#\brief   Refactored version of circle_fit with more tests;
#\author  Akihiko Yamaguchi, info@akihikoy.net
#\version 0.1
#\date    Aug.23, 2023
import numpy as np

#Fitting a circle to the data XY, return the center [x,y] and the radius
#based on: http://people.cas.uab.edu/~mosya/cl/HyperSVD.m
#cf. http://people.cas.uab.edu/~mosya/cl/MATLABcircle.html
def CircleFit2D(XY):
  centroid= np.average(XY,0) # the centroid of the data set

  X= [XY[d][0]-centroid[0] for d in range(len(XY))] # centering data
  Y= [XY[d][1]-centroid[1] for d in range(len(XY))] # centering data
  Z= [X[d]**2 + Y[d]**2 for d in range(len(XY))]
  ZXY1= np.matrix([Z, X, Y, [1.0]*len(Z)]).transpose()
  U,S,V= np.linalg.svd(ZXY1,0)
  if S[3]/S[0]<1.0e-12:  # singular case
    print('CircleFit2D: SINGULAR')
    A= (V.transpose())[:,3]
  else:  # regular case
    R= np.average(np.array(ZXY1),0)
    N= np.matrix([[8.0*R[0], 4.0*R[1], 4.0*R[2], 2.0],
                  [4.0*R[1], 1.0, 0.0, 0.0],
                  [4.0*R[2], 0.0, 1.0, 0.0],
                  [2.0,      0.0, 0.0, 0.0]])
    W= V.transpose()*np.diag(S)*V
    D,E= np.linalg.eig(W*np.linalg.inv(N)*W)  # values, vectors
    idx= D.argsort()
    Astar= E[:,idx[1]]
    A= np.linalg.solve(W, Astar)

  A= np.array(A)[:,0]
  center= -A[1:3].transpose()/A[0]/2.0+centroid
  radius= np.sqrt(A[1]**2+A[2]**2-4.0*A[0]*A[3])/abs(A[0])/2.0
  return center, radius

def Main():
  def write_polygon(fp,polygon):
    if len(polygon)>0:
      for pt in polygon+[polygon[0]]:
        fp.write('%s\n'%' '.join(map(str,pt)))
    fp.write('\n')

  polygons=[
    #[[0.744, 0.54], [0.532, 1.124], [1.12, 0.996], [1.324, 1.432], [1.608, 1.12], [2.04, 0.632], [1.464, 0.696], [1.224, 0.328], [1.16, 0.7]],
    #[[0.784, 0.58], [1.172, 1.096], [1.72, 0.524], [1.724, 1.496], [0.84, 1.516]],
    #[[0.704, 0.748], [1.18, 0.42], [1.516, 0.704], [1.416, 0.936], [1.028, 1.052], [0.876, 1.384], [1.476, 1.28], [1.932, 1.012], [2.056, 1.436], [1.172, 1.752], [0.48, 1.62], [0.364, 1.064]],
    #[[0.556, 0.764], [0.952, 0.316], [1.988, 0.368], [2.152, 0.668], [2.012, 0.928], [1.484, 0.872], [1.228, 0.936], [1.2, 1.156], [1.36, 1.312], [1.952, 1.328], [2.24, 1.432], [2.1, 1.648], [1.632, 1.844], [1.016, 1.812], [0.552, 1.492], [0.776, 1.324], [0.812, 1.068], [0.524, 0.952]],
    #[[0.504, 0.724], [0.908, 0.296], [1.7, 0.304], [1.996, 0.668], [1.98, 0.872], [1.8, 0.996], [1.396, 0.984], [1.232, 1.296], [1.732, 1.484], [1.892, 1.792], [1.088, 1.756], [0.396, 1.5], [0.684, 1.26], [0.728, 0.98]],
    [[0.729,0.049],[0.723,0.082],[0.702,0.125],[0.682,0.124],[0.654,0.106],[0.656,0.101],[0.647,0.081],[0.652,0.078],[0.651,0.071],[0.655,0.071],[0.673,0.031]],
    [[0.722,0.219],[0.717,0.220],[0.712,0.229],[0.693,0.235],[0.681,0.227],[0.672,0.230],[0.649,0.211],[0.637,0.213],[0.629,0.208],[0.626,0.216],[0.620,0.202],[0.616,0.203],[0.617,0.207],[0.609,0.200],[0.603,0.201],[0.601,0.191],[0.587,0.181],[0.589,0.175],[0.580,0.166],[0.585,0.133],[0.593,0.121],[0.605,0.113],[0.626,0.113],[0.645,0.121],[0.644,0.127],[0.651,0.123],[0.661,0.135],[0.669,0.134],[0.675,0.140],[0.702,0.148],[0.715,0.159],[0.717,0.150],[0.720,0.149],[0.721,0.167],[0.727,0.167],[0.730,0.195],[0.724,0.204]],
    [[0.820,0.156],[0.793,0.154],[0.812,0.154],[0.812,0.150],[0.803,0.149],[0.806,0.134],[0.802,0.139],[0.796,0.133],[0.786,0.140],[0.779,0.139],[0.772,0.131],[0.774,0.126],[0.782,0.127],[0.779,0.134],[0.789,0.130],[0.788,0.115],[0.794,0.109],[0.773,0.111],[0.769,0.124],[0.755,0.143],[0.749,0.144],[0.753,0.150],[0.750,0.153],[0.737,0.147],[0.731,0.149],[0.738,0.141],[0.722,0.144],[0.722,0.124],[0.726,0.126],[0.729,0.123],[0.725,0.118],[0.733,0.107],[0.733,0.090],[0.738,0.086],[0.738,0.077],[0.740,0.082],[0.744,0.080],[0.749,0.041],[0.757,0.039],[0.758,0.032],[0.763,0.034],[0.762,0.040],[0.769,0.037],[0.769,0.008],[0.781,0.024],[0.778,0.034],[0.788,0.043],[0.828,0.144],[0.819,0.150]],
    [[0.09350800007828958, -0.06681208534372196], [0.09252445550134125, -0.04205595106019444], [0.09102929047756952, -0.04304669084408408], [0.09102929047756952, -0.049904323016738916], [0.08778048481070605, -0.054046719877204163], [0.043411134815651176, -0.06189610839272125], [0.04164931016833162, -0.06000115077108248], [0.030172689576649647, -0.06189610839272125], [0.028397770522565535, -0.06000115077108248], [0.03005421297828631, -0.05337276131671126], [0.051199172153172434, -0.04906127701368507], [0.0595141204486877, -0.039079394080422436], [0.07154283094852937, -0.033753289827435085], [0.0798460063461659, -0.010428978182225712], [0.0798460063461659, -0.005344702180293259], [0.07828808358670186, 0.10346870115700652], [0.07158399133483195, 0.10750044465133884], [0.07158399133483195, 0.11095545990547012], [0.06189587222720011, 0.11982207325646782], [0.056754680771252564, 0.12153648129963157], [0.055040950285936696, 0.12496529738595896], [0.03597260336088248, 0.13265233884005756], [0.032314736396906296, 0.13692366379173065], [0.005828164028110594, 0.14420099670037761], [-0.04411327643455734, 0.1403230895655857], [-0.04816059690246019, 0.13437002177919677], [-0.04435541786238237, 0.13182292955861374], [-0.04550748164606572, 0.12545032853884674], [-0.0536607695837506, 0.12463074394532941], [-0.057866581905112624, 0.129695454322716], [-0.06048295550810251, 0.12463074394532941], [-0.05667450286633349, 0.12210821344456252], [-0.05667450286633349, 0.1187023216300635], [-0.06178132150452398, 0.11699937572281394], [-0.08176213235232571, 0.0906978255440879], [-0.08701730674694214, 0.055214853244183015], [-0.08519760094950626, 0.011976496974518247], [-0.09015494887058736, 0.00916637343034682], [-0.08966540650348004, -0.004346970761340108], [-0.07904448364511266, -0.023820530333804713], [-0.0748419449254418, -0.026571526704514792], [-0.06803222647037235, -0.03837631954795562], [-0.06473898316907772, -0.03837631954795562], [-0.05938211692739587, -0.04547715462244334], [-0.05156600996389918, -0.04496541025062112], [-0.04846980970155554, -0.04800735831201819], [-0.04225776756672128, -0.04750216373214694], [-0.03858025899259815, -0.05130517855932637], [-0.029801852046184796, -0.052053145741206897], [-0.026515155948272473, -0.05534114130058865], [-0.019941763752447772, -0.05534114130058865], [-0.01779567383229974, -0.057718369230270294], [-0.019434111478719207, -0.06263562553745328], [-0.03344425576774879, -0.06359361636158817], [-0.02563633280847999, -0.06311462094952075], [-0.024001168763751746, -0.0680220525687773], [-0.01779567383229974, -0.07083105271609164], [-0.01451879853946092, -0.06755288184463631], [-0.0015625099833801448, -0.06731829648256582], [7.756446388484939e-05, -0.07059974224999666], [0.0030651089329385983, -0.07013712131780664], [0.001421760883982437, -0.06520512797873396], [0.004708456981894815, -0.061917132419352205], [0.007712369459404234, -0.06143813700728473], [0.009358991110051562, -0.06637995503428384], [0.02545504661382436, -0.06567619894807236], [0.027350079067117505, -0.07109210004317568], [0.030172689576649647, -0.06355156830832631], [0.040101523505900794, -0.06355156830832631], [0.04362189919884879, -0.07063275400696112], [0.08662236184684174, -0.06466125553617208]],
    [[0.09931129822459756, 0.0675936228750676], [0.09318799244434489, 0.06794171774271146], [0.08865642293775283, 0.06457780177345601], [0.08561347125155022, 0.06609192711098477], [0.08561347125155022, 0.06947489465365547], [0.0812243034185231, 0.06772877729628707], [0.07795132866485743, 0.0723721494896939], [0.058253301437458604, 0.07916747488750758], [0.047460341759064384, 0.07600703276855553], [0.04602939489415142, 0.07686910725844709], [0.004741093564550436, 0.07686910725844709], [-0.0038386335420664275, 0.07435157285295052], [-0.01062543678529776, 0.0747449906698317], [-0.02114630459744532, 0.067442665741545], [-0.024074924236058337, 0.0633776592363271], [-0.022070226126111814, 0.057685029431295776], [-0.03624467743718085, 0.043457590414340275], [-0.038918966007247896, 0.04235593446710795], [-0.04054921964943947, 0.04561773085868587], [-0.04810455343832776, 0.0392747714053121], [-0.04667134283508709, 0.03635563194299546], [-0.04934573650247409, 0.029906238370418614], [-0.05909236369770432, 0.027381030776113924], [-0.06459501031196221, 0.017426375112916503], [-0.06274817711799266, 0.01300336530082119], [-0.06573582668436634, 0.009866959307265832], [-0.06661903838653332, -0.0034534288190775086], [-0.07005304656054731, -0.02063025821046932], [-0.0683360424735403, -0.02063025821046932], [-0.07005304656054731, -0.01547720939305175], [-0.06704913408303784, -0.01144822674356416], [-0.06360857870564154, -0.01144822674356416], [-0.06146802612551233, -0.02063025821046932], [-0.05500719026215084, -0.021773973754252163], [-0.056317013864491366, -0.0292186729061652], [-0.06146802612551233, -0.0292186729061652], [-0.06318503021251934, -0.03265403878444362], [-0.06790267317534465, -0.03320835680394707], [-0.05510449354684174, -0.06605488188426534], [-0.047382833009187025, -0.06702597229230212], [-0.04565437131626099, -0.07048426244240885], [-0.038740524544556953, -0.07048426244240885], [-0.037012062851630945, -0.07912998781767566], [0.04657800100598014, -0.10604262955776794], [0.047702622101170156, -0.1016226433877272], [0.05252338351726665, -0.10118949651931652], [0.05447549380551503, -0.09134568481144345], [0.07303556151935858, -0.09089943835913084], [0.07417529674804019, -0.08590220989775832], [0.08126616202266684, -0.08658140426415367], [0.0909585645953534, -0.0793612982837707], [0.09798169409782942, -0.07982391921596071], [0.1010463071209059, -0.06605488188426534], [0.10093702439013386, 0.06485339554323832]],
    [[0.08761997108609831, 0.3514373232305963], [0.07813004379506172, 0.34758802955993645], [0.0707000116364806, 0.34068729814518095], [0.06928605971750545, 0.3205650463723617], [0.06580434030736915, 0.3129341922009769], [0.06580434030736915, 0.30150644269453997], [0.061194271994111205, 0.2992049561288293], [0.059372895578868934, 0.2146643771214642], [0.05754497196024433, 0.21313586130056245], [0.059777046473444895, 0.20604106196689503], [0.05911184457569901, 0.18240752390592369], [0.06074700862042731, 0.18077171336617148], [0.060504518083681735, 0.16283312411196388], [0.06254055942129488, 0.1611083773297431], [0.06018119736802091, 0.1563178023200537], [0.06198620577480746, 0.1530060218891962], [0.058726254147547285, 0.08778524984606209], [0.051410276207994265, 0.08571034044838591], [0.04972273453620757, 0.08908675819910564], [0.04494188327788695, 0.08924757465042082], [0.040388164411219674, 0.0861653834863636], [0.029218496526742854, 0.08644978538509969], [0.025885970005154413, 0.0831159412820612], [0.022553443483566027, 0.0831159412820612], [0.019220916961977585, 0.08644978538509969], [0.01743290350112886, 0.0830557860063385], [0.014097103377849307, 0.0830557860063385], [0.011922560905844426, 0.07946494632053183], [0.0026064123330000744, 0.07564779226390037], [-0.000709393424774496, 0.06678389063630663], [0.0002145993842510574, 0.07595938385454956], [-0.0025903928882986538, 0.07628486636901566], [-0.003024389123976401, 0.08098727044128803], [-0.11449658953417569, -0.04933430964205156], [-0.12110975297349547, -0.05559005405225144], [-0.11597295007992242, -0.06899774097307566], [-0.1098438967650111, -0.06818728797045139], [-0.10735519362797599, -0.07589467189743625], [-0.10297588041698313, -0.07505801972700814], [-0.09793341885193221, -0.07700632003520895], [-0.09577158786081053, -0.08509617369429158], [-0.09701430262848251, -0.09655262041616748], [-0.09338979861889984, -0.10141463379159095], [-0.09338979861889984, -0.10650873448144989], [-0.09701430262848251, -0.11014998850635983], [-0.09747386074020736, -0.11745214593203253], [-0.1018106171292153, -0.1201685883923861], [-0.10250977510187598, -0.1295007510230326], [-0.10056462875985217, -0.12581364845446602], [-0.09281677940866828, -0.12478050252550911], [-0.09236704210201688, -0.11915509183928209], [-0.0857205157083035, -0.11230702155734397], [-0.07578401961498671, -0.10720774572631216], [-0.0711596743003591, -0.10769811952298676], [-0.06712154770004758, -0.11568998910001461], [-0.06283727403541792, -0.11669693586116771], [-0.05963631851895751, -0.12374735659655219], [-0.056047824127977486, -0.12348907011431294], [-0.05435046165111737, -0.12009300298774035], [-0.032120720258458024, -0.11728787553883914], [-0.030441362590899246, -0.11392783226799681], [-0.025077949145835055, -0.11342435888742027], [-0.023401865079967443, -0.11007086540852891], [-0.008317108487158609, -0.11007086540852891], [-0.006930355245076125, -0.10720774572631216], [-0.002171792261111416, -0.10769811952298676], [-0.0007653974088820403, -0.10481535046491712], [0.0059782220748823, -0.10481535046491712], [0.007664126945823413, -0.10144220761017285], [0.014654520431387985, -0.10096493339740016], [0.01658065210074705, -0.1038477024554698], [0.018019782969887876, -0.09928163686600351], [0.023528488764326727, -0.09665689149296343], [0.025318139026021036, -0.08804598282526284], [0.028667033556065147, -0.08469576424234694], [0.025204572830194394, -0.0849196643168436], [0.021385045508387768, -0.08244867155203707], [0.021151365913352094, -0.07783020762696309], [0.026432939316137605, -0.07403218889505382], [0.035779804179166375, -0.05877177145175537], [0.039417019669632236, -0.056510109232169856], [0.044119304487365285, -0.05877177145175537], [0.04559935537764548, -0.05081127618370422], [0.05034583381820906, -0.04970798278848419], [0.05034583381820906, -0.041324249091255774], [0.061431852128320086, -0.03731154562704987], [0.06347444066931551, -0.04135491875991042], [0.06877753649469415, -0.0437100830174111], [0.06728766479934051, -0.05151338327863923], [0.0689228288440688, -0.04824176219913483], [0.07288688266348725, -0.04631387657183854], [0.08277831418489084, -0.055422653179119055], [0.08761997108609831, -0.04573551088364965]],
    [[-0.04058574480884347, 0.0701829703156237], [-0.03983257240827881, 0.019068740478850814], [-0.034218345507960435, 0.017464041450865685], [-0.033416313093629246, 0.019068740478850814], [-0.02744979108563106, 0.0184342712592551], [-0.02744979108563106, 0.016017398029350947], [-0.02963593007783566, 0.015134383264135444], [-0.02963593007783566, 0.004682552758391488], [-0.031812248264966814, 0.0022194006850069573], [-0.034218345507960435, 0.0022194006850069573], [-0.03502037792229162, -0.0009899973709633011], [-0.03822850757961643, -0.00018764785697073655], [-0.03822850757961643, 0.0022194006850069573], [-0.03582241033662281, 0.003021750198999522], [-0.036624442750954056, 0.0038240997129920865], [-0.03582241033662281, 0.008638196796947474], [-0.037426475165285245, 0.011045245338925168], [-0.037426475165285245, 0.013452293880902862], [-0.03822850757961643, 0.013452293880902862], [-0.03822850757961643, 0.011045245338925168], [-0.03983257240827881, 0.010242895824932603], [-0.03983257240827881, -0.0009899973709633011], [-0.03822850757961643, -0.0017923468849558657], [-0.0400836298751337, -0.007377251671313083], [-0.04058574480884347, -0.030724761928849348], [-0.03760248380484438, -0.030740706108903067], [-0.03598532456941739, -0.029122907497016015], [-0.03460612839408067, -0.029135576781094255], [-0.03379591197552162, -0.030756650288956782], [-0.03101460441301024, -0.032416161948877704], [-0.02472336890010629, -0.0324353810249069], [-0.02390824207901049, -0.03080448282911793], [-0.02227798843681894, -0.03080448282911793], [-0.01983260797353159, -0.03406627922069587], [-0.015955653707849127, -0.036540032830347215], [-0.015335933124858758, -0.039023611127925004], [-0.013892901716544614, -0.039876291229713826], [-0.006512566703852085, -0.039876291229713826], [-0.005869930909023602, -0.040732246227478126], [-0.005048256884545521, -0.039088248447787244], [-0.0011074673858856854, -0.03912056710771836], [-0.0002841565605620211, -0.03829693076988517], [0.011358546768285682, -0.03928216040737394], [0.012329796607193078, -0.03758946948787453], [0.01820869722129309, -0.036923721253897764], [0.015821231725082874, -0.03689631493792987], [0.01564922872201685, -0.032608352709169675], [0.01192411400909138, -0.030900147909440234], [0.012065505819292832, -0.028413294715886966], [0.015493593727406607, -0.027580263989951025], [0.016315267751884688, -0.025936266210260135], [0.021121924897853084, -0.02594238570238741], [0.021823485523122188, -0.026773778980335616], [0.021447299157201727, -0.034426182772770694], [0.01976466788795178, -0.03526783103846902], [0.025653877330326535, -0.034426182772770694], [0.02660548555908704, -0.03272366716534485], [0.028284843226645873, -0.03272366716534485], [0.0318445021398876, -0.029338285326346043], [0.0335173126040641, -0.029338285326346043], [0.03639567943966576, -0.02596686367089652], [0.037966381313934594, -0.0259729831630238], [0.039543630391585705, -0.027646024706670325], [0.03928640864722993, -0.02935095461042428], [0.03668163156443982, -0.031883656347634265], [0.03584195273066043, -0.03608371043618718], [0.037432296215076155, -0.03610947930416734], [0.0383609892319986, -0.037763732071608345], [0.040797558753576046, -0.038634424101262305], [0.038406016340513605, -0.06708734122524643], [0.0571216550614832, 0.07731699619297863], [0.05243713104145081, 0.07575487081267473], [0.04838806867538242, 0.06910933003008574], [0.04846071485006975, 0.06109031693429962], [0.04682001346532266, 0.06048161658268406], [0.04689593324170116, 0.054046015691042455], [0.04533115163333251, 0.05169791527662338], [0.04533115163333251, 0.040740113342667784], [0.04368390304520314, 0.03616715141273386], [0.03731612081843866, 0.036290390311638034], [0.028560246157981972, 0.042714529067365455], [0.019636790873794607, 0.046150755545291196], [0.01726506644855802, 0.046150755545291196], [0.01475195021312009, 0.04867121829824662], [0.006672074301885378, 0.06311393984993646], [0.001908983841265366, 0.06867307576831352], [0.000945918006585833, 0.07124921175285209], [-0.001614665453373798, 0.07303773525528778], [-0.009355340663693312, 0.07443085694433776], [-0.01516988420465376, 0.07060948364077646], [-0.024446888471485073, 0.0701829703156237], [-0.025253831288352957, 0.06937570845766791]],
    [[0.06298292834313918, -0.10037581165853637], [0.06446687977259258, -0.09691381631263052], [0.06905357866777201, -0.09640862173275921], [0.07066255389897108, -0.09318939898886253], [0.07388050436136934, -0.09318939898886253], [0.09668047573933308, -0.057563119657665696], [0.09880054957719347, -0.05333204935194147], [0.10109638804301241, -0.03566778605462251], [0.1062375794989599, -0.02538133779564028], [0.10731222561969994, 0.041341990611223955], [0.09922427080155727, 0.06283048335154473], [0.09090138251341479, 0.07022881990867041], [0.09081400513111731, 0.0757687367510183], [0.07970740662785497, 0.08405198831855698], [0.06801821212088827, 0.0853890180194889], [0.037267112794929724, 0.09074209828862034], [0.004600085530567066, 0.08945377327078574], [-0.0199579525162612, 0.08745909882450881], [-0.0451928264444334, 0.08570425708949353], [-0.04070649424099612, 0.08363892112582277], [-0.03922254281154275, 0.07895297528473477], [-0.060348558594123164, 0.06900831181207778], [-0.06518345809730852, 0.04741331274453564], [-0.06470753197712795, 0.04325988404797981], [-0.06810553053253932, 0.03986054202543171], [-0.08532913527071012, 0.055470919951705444], [-0.06986616893881642, 0.1838149884602746], [-0.07152097459369161, 0.1838149884602746], [-0.07754635379820873, 0.018411957382543087], [-0.07410632026097463, 0.014272751666746297], [-0.07186153426689085, 0.0027870936783008227], [-0.06397556670719665, -0.0005783759876354377], [-0.06348981978194262, -0.006228432144985585], [-0.07277626192796599, -0.01653608347650143], [-0.07152097459369161, -0.02808388073717405], [-0.06606426350042971, -0.05018865172332265], [-0.0570927140542386, -0.05600615787524599], [-0.05450353912814143, -0.06175394686072977], [-0.05401727036272522, -0.07197438314907179], [-0.05115739635962627, -0.07143643960944568], [-0.04227924965895283, -0.08012258713327536], [-0.0006891125728858971, -0.09887987729477549], [0.0009247730608499816, -0.0972653535788639], [0.038483049274988745, -0.0996278444766559], [0.04009202450618787, -0.10284706722055265], [0.05001556510702082, -0.10012648926457623]],
    #[[0.07592271746968726, -0.027281217737076646], [0.07504845562351098, -0.0029418558420824525], [0.0722384176805812, -0.00566639024777893], [0.07366257333051124, -0.011285597690571747], [0.0705328711994932, -0.015903715067128954], [0.06008524268255422, -0.020898780486094337], [0.05855936136859796, -0.01970594150267929], [0.05863200754328535, -0.01494467305415531], [0.06463607087341183, -0.0007174968344094701], [0.06743590508538672, 0.016867654908367224], [0.06668200065002006, 0.037291794913368315], [0.06772593048057562, 0.04218431045483256], [0.06680765138924782, 0.04700427577699423], [0.06784830761811222, 0.0520015879896738], [0.06712177823731724, 0.04893267545542124], [0.04632535254521847, 0.10836720881772438], [-0.009627813411641761, 0.13424371561667142], [-0.011057123475709085, 0.13177685834748776], [-0.029001510060016222, 0.1315700258499018], [-0.030380079297870843, 0.12911463071663232], [-0.04559741675917117, 0.12911463071663232], [-0.06550293476807645, 0.12328936762459403], [-0.08069080981415644, 0.1148483232477947], [-0.08237835148594311, 0.11147190549707497], [-0.08891347032483751, 0.10942139031660092], [-0.11130445168604763, 0.004865435498732085], [-0.10634003472142209, -0.006722783910503405], [-0.1009127860433805, -0.008883438405979771], [-0.10372958138433239, -0.014261940994574729], [-0.10041014926950859, -0.025884546811552778], [-0.09709071715468476, -0.025884546811552778], [-0.07448489449342482, -0.04860318174720113], [-0.07284645684700536, -0.05352043805438417], [-0.06916567467119114, -0.05394048533889298], [-0.06753051062646281, -0.05721210641839736], [-0.05897042512999284, -0.0576256039109552], [-0.05407475380088139, -0.06415574648606201], [-0.04627337804499493, -0.06211953803765391], [-0.040077703918616425, -0.06335495066875019], [-0.00635225962768865, -0.05995156844517499], [-0.004685996366894429, -0.056617724342136466], [-0.001485040850433994, -0.05641425049183302], [0.0003127934154881773, -0.053283880239098], [0.005186559396125112, -0.05307713149281906], [0.006854459457764861, -0.04974001249380505], [0.010190259581044414, -0.04974001249380505], [0.011858159642684218, -0.05307713149281906], [0.013526059704323967, -0.04974001249380505], [0.019977074762612013, -0.04931996520929627], [0.031181115464845977, -0.043229782091760816], [0.03453983079996353, -0.034829673914655024], [0.0377139705654127, -0.03438342746234241], [0.03921529986668537, -0.03731032386477401], [0.04595891935044971, -0.03731032386477401], [0.05363321776090274, -0.018278517157193808], [0.05855936136859796, -0.01970594150267929], [0.05826877666984864, -0.02879860642729215], [0.07264382245012135, -0.02604253021000491]],
    #[[0.6,0.05],[0.65,0.05],[0.65,0.1],[0.6,0.1]],
    #[[0.6,0.15],[0.6,0.2],[0.65,0.15],[0.65,0.2]],
    #[[0.65,0.05],[0.7,0.05],[0.7,0.1]],
    #[[0.6,0.05],[0.6,0.1],[0.65,0.05],[0.65,0.1]],
    ]

  polygon= polygons[np.random.choice(list(range(len(polygons))))]
  center_mean= np.mean(polygon,axis=0)
  center_svd,radius_svd= CircleFit2D(polygon)
  print(('center_mean={}'.format(center_mean,center_mean)))
  print(('center_svd={} radius_svd={}'.format(center_svd,radius_svd)))

  circle_svd= [[center_svd[0]+radius_svd*np.cos(th), center_svd[1]+radius_svd*np.sin(th)]
               for th in np.linspace(-np.pi,+np.pi,100)]
  circle_mean= [[center_mean[0]+radius_svd*np.cos(th), center_mean[1]+radius_svd*np.sin(th)]
                for th in np.linspace(-np.pi,+np.pi,100)]

  with open('/tmp/polygons.dat','w') as fp:
    write_polygon(fp,polygon)
  with open('/tmp/circle_mean.dat','w') as fp:
    write_polygon(fp,circle_mean)
  with open('/tmp/circle_svd.dat','w') as fp:
    write_polygon(fp,circle_svd)

def PlotGraphs():
  print('Plotting graphs..')
  import os
  commands=[
    '''qplot -x2 aaa
        -s 'set size square; set size ratio 1.'
        /tmp/polygons.dat u 1:2:'(column(-1)+1)' w p lc var pt 4 t '"Input"'
        /tmp/circle_svd.dat u 1:2 w l pt 4 lw 2 t '"Circle/SVD"'
        /tmp/circle_mean.dat u 1:2 w l pt 4 lw 0.8 t '"Circle/Mean"'
        &''',
        #/tmp/polygons.dat u 1:2:-1 lc var w l
    '''''',
    '''''',
    ]
  for cmd in commands:
    if cmd!='':
      cmd= ' '.join(cmd.splitlines())
      print(('###',cmd))
      os.system(cmd)

  print('##########################')
  print('###Press enter to close###')
  print('##########################')
  input()
  os.system('qplot -x2kill aaa')

if __name__=='__main__':
  import sys
  if len(sys.argv)>1 and sys.argv[1] in ('p','plot','Plot','PLOT'):
    PlotGraphs()
    sys.exit(0)
  Main()

  PlotGraphs()
  sys.exit(0)
